#!/bin/bash -e
#SBATCH --job-name=run_test_step_farming_cohort
#SBATCH --ntasks=5
#SBATCH --time=00:10:00
#SBATCH --hint=nomultithread

module purge
module load gimkl CMake

nw=$((SLURM_NTASKS - 1))
nt=$((nw * 2))
echo "Number of workers: $nw number of time steps: $nt"
echo "speedup,ideal" > resultsNw${nw}.csv
for i in {0..9}; do
    echo "Running @CMAKE_BINARY_DIR@/tests/testTaskStepFarmingCohort -na $nw -nt $nt >& logNw${nw}_${i}.txt"
    srun @CMAKE_BINARY_DIR@/tests/testTaskStepFarmingCohort -na $nw -nt $nt >& logNw${nw}_${i}.txt
    speedup=$(cat logNw${nw}_${i}.txt | grep Speedup | awk '{print $5;}')
    ideal=$(cat logNw${nw}_${i}.txt | grep Speedup | awk '{print $7;}')
    echo "${speedup},${ideal}" >> resultsNw${nw}.csv
done
